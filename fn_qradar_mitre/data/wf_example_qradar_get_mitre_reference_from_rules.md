<!--
    DO NOT MANUALLY EDIT THIS FILE
    THIS FILE IS AUTOMATICALLY GENERATED WITH resilient-sdk codegen
-->

# Example: QRadar - Get MITRE Reference From Rules

## Function - QRadar Get Offense MITRE Reference

### API Name
`qradar_get_offense_mitre_reference`

### Output Name
`None`

### Message Destination
`fn_qradar_mitre`

### Pre-Processing Script
```python
inputs.qradar_offense_id = incident.properties.qradar_id
```

### Post-Processing Script
```python
""" Example Results
{
    'rules': [{
            'id': 119751,
            'identifier': 'a444890b-eca7-44f7-8903-962c12377715',
            'name': 'Suspicious Activity Followed by Endpoint Administration
            Task',
            'mapping': {
                'Discovery': {
                    'confidence': 'high',
                    'user_override': False,
                    'enabled': True,
                    'ibm_default': True,
                    'id': 'TA0007',
                    'techniques': {
                        'Network Share Discovery': {
                            'confidence': 'high',
                            'enabled': True,
                            'id': 'T1135'
                        },
                        'Query Registry': {
                            'confidence': 'high',
                            'enabled': True,
                            'id': 'T1012'
                        },
                        'Password Policy Discovery': {
                            'confidence': 'high',
                            'enabled': True,
                            'id': 'T1201'
                        },
                        'Permission Groups Discovery': {
                            'confidence': 'high',
                            'enabled': True,
                            'id': 'T1069'
                        }
                    }
                },
                'Credential Access': {
                    'confidence': 'high',
                    'user_override': False,
                    'enabled': True,
                    'ibm_default': True,
                    'id': 'TA0006',
                    'techniques': {
                        'OS Credential Dumping': {
                            'confidence': 'high',
                            'enabled': True,
                            'id': 'T1003'
                        },
                        'Credentials in Registry': {
                            'confidence': 'high',
                            'enabled': True,
                            'id': 'T1552.002'
                        },
                        'Credentials In Files': {
                            'confidence': 'high',
                            'enabled': True,
                            'id': 'T1552.001'
                        },
                        'Brute Force': {
                            'confidence': 'medium',
                            'enabled': True,
                            'id': 'T1110'
                        }
                    }
                },
                'Command and Control': {
                    'confidence': 'high',
                    'user_override': False,
                    'enabled': True,
                    'ibm_default': False,
                    'id': 'TA0011',
                    'techniques': {}
                }
            }
        }, {
            'id': 111851,
            'identifier': 'e7f90768-1946-4e55-9922-f94bb3d635b7',
            'name': 'QNI : Observed File Hash Associated with Malware Threat',
            'mapping': {
                'Execution': {
                    'confidence': 'high',
                    'user_override': False,
                    'enabled': True,
                    'ibm_default': True,
                    'id': 'TA0002',
                    'techniques': {}
                }
            }
        }, {
            'id': 130651,
            'identifier': '724f71bf-abde-407f-aca7-4451366a7d63',
            'name': 'Workstation Detected with Python, Powershell or Curl as HTTP User Agent',
            'mapping': {}
        }, {
            'id': 118701,
            'identifier': 'f6d184fd-7111-4ca9-b22c-155886a35e7e',
            'name': 'Detection of Malicious IOC',
            'mapping': {
                'Command and
                Control': {
                    'confidence': 'high',
                    'user_override': False,
                    'enabled': True,
                    'ibm_default': False,
                    'id': 'TA0011',
                    'techniques': {}
                }
            }
        }
    ]
}

"""

for item in results.content['rules']:
  mapping = item['mapping']
  if mapping:
    for tactic in list(mapping):
      techniques = mapping[tactic]['techniques']
      if techniques:
        for technique in list(techniques):
          new_row = incident.addRow('qradar_rules_and_mitre_tactics_and_techniques')
          new_row.rule_id = item['id']
          new_row.rule_identifier = item['identifier']
          new_row.rule_name = item['name']
          new_row.mitre_tactic = tactic
          new_row.mitre_tactic_id = mapping[tactic]['id']
          new_row.tactic_confidence_level = mapping[tactic]['confidence']
          new_row.mitre_technique = technique
          new_row.mitre_technique_id = techniques[technique]['id']
          new_row.technique_confidence_level = techniques[technique]['confidence']
      else:
        new_row = incident.addRow('qradar_rules_and_mitre_tactics_and_techniques')
        new_row.rule_id = item['id']
        new_row.rule_identifier = item['identifier']
        new_row.rule_name = item['name']
        new_row.mitre_tactic = tactic
        new_row.mitre_tactic_id = mapping[tactic]['id']
        new_row.tactic_confidence_level = mapping[tactic]['confidence']
  else:
    new_row = incident.addRow('qradar_rules_and_mitre_tactics_and_techniques')
    new_row.rule_id = item['id']
    new_row.rule_identifier = item['identifier']
    new_row.rule_name = item['name']

```

---

